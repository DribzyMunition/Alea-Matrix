<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Risk Calculator — Matrix Green</title>
  <style>
    :root{
      --bg:#030d03;           /* near-black with green tint */
      --grid:#0f2d0f;         /* dark grid lines */
      --panel:#081808;        /* cards */
      --text:#b6ffb6;         /* primary green */
      --muted:#76c876;        /* secondary green */
      --accent:#00ff88;       /* neon accent */
      --danger:#ff5577;       /* warnings */
      --ok:#44ff99;           /* success */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      display:flex; align-items:center; justify-content:center; padding:24px;
      letter-spacing: .2px;
    }
    .app{width: min(1100px, 100%);}

    /* Subtle matrix grid background */
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image: linear-gradient(var(--grid) 1px, transparent 1px),
                        linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: 24px 24px, 24px 24px;
      mix-blend-mode: screen; opacity:.25;
    }
    /* Matrix rain overlay */
    .rain{position:fixed; inset:0; pointer-events:none; opacity:.15;}
    .rain canvas{width:100%; height:100%; display:block}

    h1{margin:0 0 18px; font-weight:700; letter-spacing:.6px}
    .sub{color:var(--muted); margin-bottom:24px;}

    .grid{display:grid; gap:16px; grid-template-columns: 1.2fr 1fr;}

    .card{background:linear-gradient(180deg, rgba(8,24,8,.9), rgba(8,24,8,.6));
          border:1px solid #0b2a0b; border-radius:16px; padding:18px; box-shadow:0 0 0 1px rgba(0,255,100,.06), 0 10px 30px rgba(0,0,0,.35)}

    .inputs{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .inputs label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .inputs input{width:100%; padding:12px 12px; border-radius:12px; border:1px solid #0b2a0b; background:#051105; color:var(--text); outline:none}
    .inputs input:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(0,255,136,.12)}

    .row-span{grid-column: span 2}

    .btns{display:flex; gap:10px; margin-top:8px}
    button{cursor:pointer; border:1px solid #0b2a0b; background:#041004; color:var(--text); padding:12px 14px; border-radius:12px; font-weight:600}
    button.primary{border-color:var(--accent); box-shadow:0 0 0 1px rgba(0,255,136,.2) inset}
    button:hover{filter:brightness(1.15)}

    .kpi-wrap{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
    .kpi{background:#051405; border:1px solid #0b2a0b; border-radius:14px; padding:14px}
    .kpi .label{font-size:12px; color:var(--muted)}
    .kpi .value{font-size:22px; font-weight:700; margin-top:6px}
    .kpi small{display:block; opacity:.8; margin-top:4px}

    .table{width:100%; border-collapse:collapse; margin-top:12px}
    .table th,.table td{border-bottom:1px dashed #0b2a0b; padding:10px 6px; text-align:left}
    .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #0b2a0b; background:#071707}

    .danger{color:var(--danger)}
    .ok{color:var(--ok)}
    .muted{color:var(--muted)}
    .foot{margin-top:16px; font-size:12px; color:var(--muted)}

    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
      .inputs{grid-template-columns:1fr}
      .row-span{grid-column: auto}
      .kpi-wrap{grid-template-columns:1fr 1fr}
    }
  </style>
</head>
<body>
  <div class="rain"><canvas id="matrix"></canvas></div>
  <div class="app">
    <h1>Risk Calculator</h1>
    <div class="sub">Matrix-green, minimal, and fast. Feed the inputs, get position sizing and Kelly-derived guidance. Nothing here is advice.</div>

    <div class="grid">
      <section class="card">
        <div class="inputs">
          <div>
            <label>Account Size (base currency)</label>
            <input id="account" type="number" inputmode="decimal" placeholder="25000" value="25000" />
          </div>
          <div>
            <label>Risk per Trade (%)</label>
            <input id="riskPct" type="number" inputmode="decimal" placeholder="1" value="1" />
          </div>

          <div>
            <label>Entry Price</label>
            <input id="entry" type="number" inputmode="decimal" placeholder="100" value="100" />
          </div>
          <div>
            <label>Stop Price</label>
            <input id="stop" type="number" inputmode="decimal" placeholder="95" value="95" />
          </div>

          <div>
            <label>Target Price</label>
            <input id="target" type="number" inputmode="decimal" placeholder="110" value="110" />
          </div>
          <div>
            <label>Win Rate (0–1)</label>
            <input id="win" type="number" step="0.01" min="0" max="1" placeholder="0.45" value="0.45" />
          </div>

          <div class="row-span">
            <label>Tick/Contract Multiplier (optional)</label>
            <input id="mult" type="number" inputmode="decimal" placeholder="1 for stocks, 100 for options, etc." value="1" />
          </div>
        </div>
        <div class="btns">
          <button class="primary" id="calc">Calculate</button>
          <button id="reset">Reset</button>
        </div>
        <div class="foot">Formulas: pos = (account×risk%) / (|entry−stop|×mult). RR = |target−entry|/|entry−stop|. Kelly f = p − (1−p)/RR. Suggested risk ≈ ½·Kelly (capped 0–2%).</div>
      </section>

      <section class="card">
        <div class="kpi-wrap">
          <div class="kpi"><div class="label">Risk Amount</div><div class="value" id="riskAmt">—</div><small class="muted">Base currency</small></div>
          <div class="kpi"><div class="label">Position Size (units)</div><div class="value" id="pos">—</div><small class="muted">Shares / contracts</small></div>
          <div class="kpi"><div class="label">R:R</div><div class="value" id="rr">—</div><small class="muted">Reward : Risk</small></div>
        </div>
        <div class="kpi-wrap" style="margin-top:12px">
          <div class="kpi"><div class="label">Kelly Fraction</div><div class="value" id="kelly">—</div><small class="muted">Theoretical optimal f</small></div>
          <div class="kpi"><div class="label">Suggested Risk %</div><div class="value" id="sugRisk">—</div><small class="muted">½·Kelly (0–2% cap)</small></div>
          <div class="kpi"><div class="label">EV / trade</div><div class="value" id="ev">—</div><small class="muted">In R units</small></div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <table class="table">
        <thead>
          <tr><th>Scenario</th><th>Metric</th><th>Value</th><th>Note</th></tr>
        </thead>
        <tbody id="scenarios">
          <tr><td>Losing Streak (95% conf.)</td><td><span class="pill">max consecutive losses</span></td><td id="ls">—</td><td class="muted">Plan sizing to survive this</td></tr>
          <tr><td>Drawdown Budget</td><td><span class="pill">risk% × streak</span></td><td id="dd">—</td><td class="muted">Keep under psychological limit</td></tr>
          <tr><td>Stop Distance</td><td><span class="pill">|entry−stop|</span></td><td id="dist">—</td><td class="muted">Price units</td></tr>
        </tbody>
      </table>
    </section>

    <div class="foot">Tip: if Kelly is negative, your edge is insufficient—tighten stops, improve RR, or stand down.</div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const fmt = (n, d=2) => isFinite(n) ? Number(n).toLocaleString(undefined,{maximumFractionDigits:d, minimumFractionDigits:d}) : '—';

    function calc(){
      const account = parseFloat($("account").value);
      const riskPct = parseFloat($("riskPct").value)/100; // to fraction
      const entry = parseFloat($("entry").value);
      const stop = parseFloat($("stop").value);
      const target = parseFloat($("target").value);
      const p = Math.max(0, Math.min(1, parseFloat($("win").value)));
      const mult = Math.max(0.0000001, parseFloat($("mult").value)||1);

      const dist = Math.abs(entry - stop);
      const reward = Math.abs(target - entry);
      const rr = reward / (dist || 1e-9);

      const riskAmt = account * riskPct;
      const pos = riskAmt / (dist * mult || 1e-9);

      // Kelly
      const kelly = p - (1 - p) / (rr || 1e-9);
      const kellyClamped = Math.max(-1, Math.min(1, kelly));
      const suggested = Math.max(0, Math.min(0.02, 0.5 * Math.max(0, kellyClamped)));

      // EV per trade in R units: EV_R = p*RR - (1-p)*1
      const evR = p * rr - (1 - p);

      // Losing streak approximation (95% conf): solve (1-p)^{L} ~ 0.05 => L ~ ln(0.05)/ln(1-p)
      let losingStreak = '—';
      if(p<1){ losingStreak = Math.ceil(Math.log(0.05) / Math.log(1 - p)); }
      const dd = (losingStreak==='—' ? '—' : fmt(losingStreak * riskPct * 100, 1) + '%');

      $("riskAmt").textContent = fmt(riskAmt, 2);
      $("pos").textContent = isFinite(pos) && pos>0 ? fmt(pos, 2) : '—';
      $("rr").textContent = isFinite(rr) ? fmt(rr, 2) : '—';
      $("kelly").innerHTML = (kellyClamped>=0?'<span class="ok">':'<span class="danger">') + fmt(kellyClamped, 2) + '</span>';
      $("sugRisk").textContent = fmt(suggested*100, 2) + '%';
      $("ev").innerHTML = (evR>=0?'<span class="ok">':'<span class="danger">') + fmt(evR, 2) + '</span>';
      $("ls").textContent = losingStreak;
      $("dd").textContent = dd;
      $("dist").textContent = fmt(dist, 4);
    }

    $("calc").addEventListener('click', calc);
    $("reset").addEventListener('click', ()=>{
      ["account","riskPct","entry","stop","target","win","mult"].forEach(id=>$(id).value = $(id).getAttribute('value'));
      ["riskAmt","pos","rr","kelly","sugRisk","ev","ls","dd","dist"].forEach(id=>$(id).textContent = '—');
    });

    // Matrix rain effect (lightweight)
    (function(){
      const canvas = $("matrix");
      const ctx = canvas.getContext('2d');
      let w, h, columns, drops;
      const glyphs = '01█░▒▓';

      function resize(){
        canvas.width = w = window.innerWidth;
        canvas.height = h = window.innerHeight;
        const fontSize = 16; ctx.font = fontSize + 'px monospace';
        columns = Math.floor(w / fontSize);
        drops = Array(columns).fill(0).map(()=>Math.random()*h);
      }
      window.addEventListener('resize', resize); resize();

      function step(){
        ctx.fillStyle = 'rgba(0,8,0,0.08)';
        ctx.fillRect(0,0,w,h);
        ctx.fillStyle = 'rgba(0,255,120,0.65)';
        for(let i=0;i<columns;i++){
          const ch = glyphs[Math.floor(Math.random()*glyphs.length)];
          ctx.fillText(ch, i*16, drops[i]);
          drops[i] += 16*(0.8 + Math.random()*0.6);
          if(drops[i]>h && Math.random()>0.975){ drops[i]=0; }
        }
        requestAnimationFrame(step);
      }
      step();
    })();

    // Initial calc for demo values
    calc();
  </script>
</body>
</html>
